name: Reference Repo Updated

on:
  repository_dispatch:
    types: [reference-repo-updated]
  workflow_dispatch:
    inputs:
      sha:
        description: 'Commit SHA (for testing)'
        default: 'test-sha'
      message:
        description: 'Commit message (for testing)'
        default: 'Manual test trigger'

jobs:
  create-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Create sync issue
        uses: actions/github-script@v7
        with:
          script: |
            // Handle both repository_dispatch and workflow_dispatch
            const isDispatch = context.eventName === 'repository_dispatch';
            const message = isDispatch
              ? (context.payload.client_payload?.message || 'No message')
              : (context.payload.inputs?.message || 'Manual test');
            const sha = isDispatch
              ? (context.payload.client_payload?.sha || 'unknown')
              : (context.payload.inputs?.sha || 'manual');
            const shortSha = sha.substring(0, 7);

            // Truncate message for title if too long
            const titleMessage = message.length > 50 ? message.substring(0, 50) + '...' : message;

            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ðŸ”„ Reference repo updated: ${titleMessage}`,
              body: `The reference repo (ClaudeCode-DevPlanBuilder) has been updated.

**Commit**: [\`${shortSha}\`](https://github.com/mmorris35/ClaudeCode-DevPlanBuilder/commit/${sha})
**Message**: ${message}

[View full diff](https://github.com/mmorris35/ClaudeCode-DevPlanBuilder/commit/${sha})

---

Review the changes and sync the MCP server if needed. Common updates to watch for:
- New agent types (executor, verifier, etc.)
- Changes to plan structure or templates
- New documentation patterns`,
              labels: ['sync', 'reference-repo']
            });
